container_commands:
  01_install_pgvector:
    command: |
      # Install PostgreSQL client to enable pgvector
      yum install -y postgresql15
    ignoreErrors: false

  02_enable_pgvector:
    command: |
      # Enable pgvector extension
      export PGPASSWORD=$RDS_PASSWORD
      psql -h $RDS_HOSTNAME -p $RDS_PORT -U $RDS_USERNAME -d $RDS_DB_NAME -c "CREATE EXTENSION IF NOT EXISTS vector;" || echo "pgvector extension setup will be done after first deployment"
    ignoreErrors: true

  03_run_migrations:
    command: "npx prisma migrate deploy"
    leader_only: true
    ignoreErrors: true

  04_seed_database:
    command: "npx prisma db seed"
    leader_only: true
    ignoreErrors: true
